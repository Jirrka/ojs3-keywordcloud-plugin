!function(){function t(){var t=[256,256],h=n,s=e,y=a,x=r,d=r,g=o,m=i,p=c,M=[],w=1/0,b=d3.dispatch("word","end"),z=null,I={};function k(n,e,r){t[0],t[1];for(var a,o,i,u,l,c=e.x,h=e.y,s=Math.sqrt(t[0]*t[0]+t[1]*t[1]),y=p(t),x=Math.random()<.5?1:-1,d=-x;(a=y(d+=x))&&(o=~~a[0],i=~~a[1],!(Math.min(o,i)>s));)if(e.x=c+o,e.y=h+i,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>t[0]||e.y+e.y1>t[1]||r&&f(e,n,t[0])||r&&(l=r,!((u=e).x+u.x1>l[0].x&&u.x+u.x0<l[1].x&&u.y+u.y1>l[0].y&&u.y+u.y0<l[1].y)))){for(var g,v=e.sprite,m=e.width>>5,M=t[0]>>5,w=e.x-(m<<4),b=127&w,z=32-b,I=e.y1-e.y0,k=(e.y+e.y0)*M+(w>>5),T=0;T<I;T++){g=0;for(var q=0;q<=m;q++)n[k+q]|=g<<z|(q<m?(g=v[T*m+q])>>>b:0);k+=M}return delete e.sprite,!0}return!1}return I.start=function(){var n=function(t){var n=[],e=-1;for(;++e<t;)n[e]=0;return n}((t[0]>>5)*t[1]),e=null,r=M.length,a=-1,o=[],i=M.map(function(t,n){return t.text=h.call(this,t,n),t.font=s.call(this,t,n),t.style=x.call(this,t,n),t.weight=d.call(this,t,n),t.rotate=g.call(this,t,n),t.size=~~y.call(this,t,n),t.padding=m.call(this,t,n),t}).sort(function(t,n){return n.size-t.size});return z&&clearInterval(z),z=setInterval(f,0),f(),I;function f(){for(var f,c=+new Date;+new Date-c<w&&++a<r&&z;)(f=i[a]).x=t[0]*(Math.random()+.5)>>1,f.y=t[1]*(Math.random()+.5)>>1,u(f,i,a),f.hasText&&k(n,f,e)&&(o.push(f),b.word(f),e?l(e,f):e=[{x:f.x+f.x0,y:f.y+f.y0},{x:f.x+f.x1,y:f.y+f.y1}],f.x-=t[0]>>1,f.y-=t[1]>>1);a>=r&&(I.stop(),b.end(o,e))}},I.stop=function(){return z&&(clearInterval(z),z=null),I},I.timeInterval=function(t){return arguments.length?(w=null==t?1/0:t,I):w},I.words=function(t){return arguments.length?(M=t,I):M},I.size=function(n){return arguments.length?(t=[+n[0],+n[1]],I):t},I.font=function(t){return arguments.length?(s=d3.functor(t),I):s},I.fontStyle=function(t){return arguments.length?(x=d3.functor(t),I):x},I.fontWeight=function(t){return arguments.length?(d=d3.functor(t),I):d},I.rotate=function(t){return arguments.length?(g=d3.functor(t),I):g},I.text=function(t){return arguments.length?(h=d3.functor(t),I):h},I.spiral=function(t){return arguments.length?(p=v[t+""]||t,I):p},I.fontSize=function(t){return arguments.length?(y=d3.functor(t),I):y},I.padding=function(t){return arguments.length?(m=d3.functor(t),I):m},d3.rebind(I,b,"on")}function n(t){return t.text}function e(){return"serif"}function r(){return"normal"}function a(t){return Math.sqrt(t.value)}function o(){return 10*(~~(6*Math.random())-3)}function i(){return 1}function u(t,n,e){if(!t.sprite){g.clearRect(0,0,(y<<5)/d,x/d);var r=0,a=0,o=0,i=n.length;for(--e;++e<i;){t=n[e],g.save(),g.font=t.style+" "+t.weight+" "+~~((t.size+1)/d)+"px "+t.font;var u=g.measureText(t.text+"m").width*d,f=t.size<<1;if(t.rotate){var l=Math.sin(t.rotate*s),c=Math.cos(t.rotate*s),h=u*c,v=u*l,m=f*c,p=f*l;u=Math.max(Math.abs(h+p),Math.abs(h-p))+31>>5<<5,f=~~Math.max(Math.abs(v+m),Math.abs(v-m))}else u=u+31>>5<<5;if(f>o&&(o=f),r+u>=y<<5&&(r=0,a+=o,o=0),a+f>=x)break;g.translate((r+(u>>1))/d,(a+(f>>1))/d),t.rotate&&g.rotate(t.rotate*s),g.fillText(t.text,0,0),t.padding&&(g.lineWidth=2*t.padding,g.strokeText(t.text,0,0)),g.restore(),t.width=u,t.height=f,t.xoff=r,t.yoff=a,t.x1=u>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,r+=u}for(var M=g.getImageData(0,0,(y<<5)/d,x/d).data,w=[];--e>=0;)if((t=n[e]).hasText){for(var b=(u=t.width)>>5,z=(f=t.y1-t.y0,0);z<f*b;z++)w[z]=0;if(null==(r=t.xoff))return;a=t.yoff;for(var I=0,k=-1,T=0;T<f;T++){for(z=0;z<u;z++){var q=b*T+(z>>5),D=M[(a+T)*(y<<5)+(r+z)<<2]?1<<31-z%32:0;w[q]|=D,I|=D}I?k=T:(t.y0++,f--,T--,a++)}t.y1=t.y0+k,t.sprite=w.slice(0,(t.y1-t.y0)*b)}}}function f(t,n,e){e>>=5;for(var r,a=t.sprite,o=t.width>>5,i=t.x-(o<<4),u=127&i,f=32-u,l=t.y1-t.y0,c=(t.y+t.y0)*e+(i>>5),h=0;h<l;h++){r=0;for(var s=0;s<=o;s++)if((r<<f|(s<o?(r=a[h*o+s])>>>u:0))&n[c+s])return!0;c+=e}return!1}function l(t,n){var e=t[0],r=t[1];n.x+n.x0<e.x&&(e.x=n.x+n.x0),n.y+n.y0<e.y&&(e.y=n.y+n.y0),n.x+n.x1>r.x&&(r.x=n.x+n.x1),n.y+n.y1>r.y&&(r.y=n.y+n.y1)}function c(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}var h,s=Math.PI/180,y=64,x=2048,d=1;"undefined"!=typeof document?((h=document.createElement("canvas")).width=1,h.height=1,d=Math.sqrt(h.getContext("2d").getImageData(0,0,1,1).data.length>>2),h.width=(y<<5)/d,h.height=x/d):h=new Canvas(y<<5,x);var g=h.getContext("2d"),v={archimedean:c,rectangular:function(t){var n=4*t[0]/t[1],e=0,r=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:e+=n;break;case 1:r+=4;break;case 2:e-=n;break;default:r-=4}return[e,r]}}};g.fillStyle=g.strokeStyle="red",g.textAlign="center","object"==typeof module&&module.exports?module.exports=t:(d3.layout||(d3.layout={})).cloud=t}();